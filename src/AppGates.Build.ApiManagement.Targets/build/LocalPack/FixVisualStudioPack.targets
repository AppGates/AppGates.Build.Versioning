<Project>
  <PropertyGroup>
    <IsPackableCopy>true</IsPackableCopy>
    <IsPackableCopy Condition="'$(IsPackable)' == 'false'">false</IsPackableCopy>
  </PropertyGroup>

  <!--Avoid the weird half dependency build of Visual Studio during pack-->
  <PropertyGroup >
    <IsPackable>false</IsPackable>
  </PropertyGroup>

  <Target Name="CustomPack" AfterTargets="Pack" >
    <PropertyGroup>
      <RebuildOnVisualStudioPack Condition="'$(RebuildOnVisualStudioPack)' == ''">true</RebuildOnVisualStudioPack>
      <CustomPackTargets Condition="'$(RebuildOnVisualStudioPack)' == 'true'">Rebuild</CustomPackTargets>
      <CustomPackTargets Condition="'$(RebuildOnVisualStudioPack)' == 'false'">Restore;Build</CustomPackTargets>

      <CustomPackBuildProperties>
        GeneratePackageOnBuild=true;
        NoBuild=false;
        BuildingProject=true;
        <!--BuildDependsOn=$(BuildDependsOn_Copy);-->
        <!--IsPackable=true;-->
        BuildingInsideVisualStudio=false;
        IsLocalBuild=$(IsLocalBuild);
      </CustomPackBuildProperties>
    </PropertyGroup>
    <Message Text="IsPackableCopy: $(IsPackableCopy)"/>
    <MSBuild
       Targets="$(CustomPackTargets)"
      Condition="$(IsPackableCopy)"
             Projects="$(MSBuildProjectFullPath)"
             Properties="$(CustomPackBuildProperties)"/>

  </Target>



</Project>